!function t(e,n,r){function i(c,s){if(!n[c]){if(!e[c]){var a="function"==typeof require&&require;if(!s&&a)return a(c,!0);if(o)return o(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[c]={exports:{}};e[c][0].call(l.exports,function(t){var n=e[c][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[c].exports}for(var o="function"==typeof require&&require,c=0;c<r.length;c++)i(r[c]);return i}({1:[function(t,e,n){!function(){"use strict";var r=t("./js/util/console")(),i=t("./js/util/slugify");t("./js/util/handlebar-helpers");var o={"idpf-wasteland":t("../src/js/template-builders/idpf-wasteland-builder.js").builder},c=function(){var t=this,e={toc:[],landmarks:[],sections:[],stylesheet:{}};this.withUuid=function(n){return e.uuid=n,t},this.withTemplate=function(n){return e.templateName=n,t},this.withTitle=function(n){return e.title=n,e.slug=i(n),t},this.withLanguage=function(n){return e.lang=n,t},this.withAuthor=function(n){return e.author=n,t},this.withModificationDate=function(n){return e.modificationDate=n.toISOString(),t},this.withRights=function(n){return e.rights=n,t},this.withCover=function(n,r){return e.coverUrl=n,e.coverRights=r,t},this.withAttributionUrl=function(n){return e.attributionUrl=n,t},this.withStylesheetUrl=function(n,r){return e.stylesheet={url:n,styles:"",replaceOriginal:r},t},this.withSection=function(n){return e.sections.push(n),Array.prototype.push.apply(e.toc,n.collectToc()),Array.prototype.push.apply(e.landmarks,n.collectLandmarks()),t},this.makeEpub=function(){return e.publicationDate=(new Date).toISOString(),o[e.templateName].make(e).then(function(t){r.info("generating epub for: "+e.title);var n=t.generate({type:"blob",mimeType:"application/epub+zip",compression:"DEFLATE"});return n})},this.downloadEpub=function(n){t.makeEpub().then(function(t){var i=e.slug+".epub";r.debug('saving "'+i+'"...'),n&&"function"==typeof n&&n(t,i),saveAs(t,i)})}};if(c.epubtypes=t("../src/js/epub-types.js"),c.Section=function(t,e,n,r,i){function o(t,e){for(var n=t[e]?[t]:[],r=0;r<t.subSections.length;r++)Array.prototype.push.apply(n,o(t.subSections[r],e));return n}var c=this;this.epubType=t,this.id=e,this.content=n,this.includeInToc=r,this.includeInLandmarks=i,this.subSections=[],n&&(n.renderTitle=n.renderTitle!==!1),this.withSubSection=function(t){return c.subSections.push(t),c},this.collectToc=function(){return o(this,"includeInToc")},this.collectLandmarks=function(){return o(this,"includeInLandmarks")}},"undefined"!=typeof e)e.exports.EpubMaker=c;else if("undefined"!=typeof n)n.EpubMaker=c;else if("undefined"==typeof window)throw new Error("unable to expose EpubMaker: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.EpubMaker=c)}()},{"../src/js/epub-types.js":4,"../src/js/template-builders/idpf-wasteland-builder.js":5,"./js/util/console":7,"./js/util/handlebar-helpers":8,"./js/util/slugify":9}],2:[function(t,e,n){(function(t){!function(n){"use strict";function r(t){d(function(){throw t})}function i(t){return this.then(t,n)}function o(t){return this.then(n,t)}function c(t,e){return this.then(function(e){return h(t)?t.apply(null,m(e)?e:[e]):k.onlyFuncs?e:t},e||n)}function s(t){function e(){t()}return this.then(e,e),this}function a(t){return this.then(function(e){return h(t)?t.apply(null,m(e)?e.splice(0,0,void 0)&&e:[void 0,e]):k.onlyFuncs?e:t},function(e){return t(e)})}function u(t){return this.then(n,t?function(e){throw t(e),e}:r)}function l(t,e){var n=w(t);if(1===n.length&&m(n[0])){if(!n[0].length)return k.fulfilled([]);n=n[0]}var r=[],i=k(),o=n.length;if(o)for(var c=function(t){n[t]=k.promisify(n[t]),n[t].then(function(c){r[t]=e?n[t]:c,--o||i.resolve(r)},function(c){e?(r[t]=n[t],--o||i.resolve(r)):i.reject(c)})},s=0,a=o;s<a;s++)c(s);else i.resolve(r);return i.promise}function f(t,e){return t.then(h(e)?e:function(){return e})}function p(t){var e=w(t);1===e.length&&m(e[0])&&(e=e[0]);for(var n=k(),r=0,i=e.length,o=k.resolved();r<i;r++)o=f(o,e[r]);return n.resolve(o),n.promise}var d,h=function(t){return"function"==typeof t},m=function(t){return Array.isArray?Array.isArray(t):t instanceof Array},g=function(t){return!(!t||!(typeof t).match(/function|object/))},y=function(t){return t===!1||t===n||null===t},w=function(t,e){return[].slice.call(t,e)},v="undefined",b=typeof TypeError===v?Error:TypeError;if(typeof t!==v&&t.nextTick)d=t.nextTick;else if(typeof MessageChannel!==v){var x=new MessageChannel,T=[];x.port1.onmessage=function(){T.length&&T.shift()()},d=function(t){T.push(t),x.port2.postMessage(0)}}else d=function(t){setTimeout(t,0)};var k=function(t){function e(){if(0!==m){var t,e=w,n=0,r=e.length,i=~m?0:1;for(w=[];n<r;n++)(t=e[n][i])&&t(f)}}function r(t){function n(t){return function(e){return i?void 0:(i=!0,t(e))}}var i=!1;if(m)return this;try{var o=g(t)&&t.then;if(h(o)){if(t===v)throw new b("Promise can't resolve itself");return o.call(t,n(r),n(l)),this}}catch(c){return n(l)(c),this}return p(function(){f=t,m=1,e()}),this}function l(t){return m||p(function(){try{throw t}catch(n){f=n}m=-1,e()}),this}var f,p=(n!==t?t:k.alwaysAsync)?d:function(t){t()},m=0,w=[],v={then:function(t,n){var r=k();return w.push([function(e){try{y(t)?r.resolve(e):r.resolve(h(t)?t(e):k.onlyFuncs?e:t)}catch(n){r.reject(n)}},function(t){if((y(n)||!h(n)&&k.onlyFuncs)&&r.reject(t),n)try{r.resolve(h(n)?n(t):n)}catch(e){r.reject(e)}}]),0!==m&&p(e),r.promise},success:i,error:o,otherwise:o,apply:c,spread:c,ensure:s,nodify:a,rethrow:u,isPending:function(){return 0===m},getStatus:function(){return m}};return v.toSource=v.toString=v.valueOf=function(){return f===n?this:f},{promise:v,resolve:r,fulfill:r,reject:l}};if(k.deferred=k.defer=k,k.nextTick=d,k.alwaysAsync=!0,k.onlyFuncs=!0,k.resolved=k.fulfilled=function(t){return k(!0).resolve(t).promise},k.rejected=function(t){return k(!0).reject(t).promise},k.wait=function(t){var e=k();return setTimeout(e.resolve,t||0),e.promise},k.delay=function(t,e){var n=k();return setTimeout(function(){try{n.resolve(h(t)?t.apply(null):t)}catch(e){n.reject(e)}},e||0),n.promise},k.promisify=function(t){return t&&h(t.then)?t:k.resolved(t)},k.all=function(){return l(arguments,!1)},k.resolveAll=function(){return l(arguments,!0)},k.sequence=function(){return p(arguments)},k.nodeCapsule=function(t,e){return e||(e=t,t=void 0),function(){var n=k(),r=w(arguments);r.push(function(t,e){t?n.reject(t):n.resolve(arguments.length>2?w(arguments,1):e)});try{e.apply(t,r)}catch(i){n.reject(i)}return n.promise}},"function"==typeof define&&define.amd)define("D.js",[],function(){return k});else if(typeof e!==v&&e.exports)e.exports=k;else if(typeof window!==v){var j=window.D;k.noConflict=function(){return window.D=j,k},window.D=k}}()}).call(this,t("_process"))},{_process:3}],3:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function c(t){if(p===clearTimeout)return clearTimeout(t);if((p===i||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function s(){g&&h&&(g=!1,h.length?m=h.concat(m):y=-1,m.length&&a())}function a(){if(!g){var t=o(s);g=!0;for(var e=m.length;e;){for(h=m,m=[];++y<e;)h&&h[y].run();y=-1,e=m.length}h=null,g=!1,c(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var f,p,d=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(t){f=r}try{p="function"==typeof clearTimeout?clearTimeout:i}catch(t){p=i}}();var h,m=[],g=!1,y=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new u(t,e)),1!==m.length||g||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],4:[function(t,e,n){!function(){"use strict";function t(t){return{"abstract":"frontmatter",foreword:"frontmatter",preface:"frontmatter",introduction:"frontmatter",preamble:"frontmatter",epigraph:"frontmatter","non-specific frontmatter":"frontmatter",part:"bodymatter",chapter:"bodymatter",prologue:"bodymatter",conclusion:"bodymatter",epilogue:"bodymatter",afterword:"backmatter","non-specific backmatter":"backmatter",rearnote:"backmatter"}[t]}for(var n=[{name:"abstract",group:"Front Matter",description:"A short summary of the principle ideas, concepts and conclusions of the work, or of a section or except within it."},{name:"foreword",group:"Front Matter",description:"An introductory section that precedes the work, typically not written by the work's author."},{name:"preface",group:"Front Matter",description:"An introductory section that precedes the work, typically written by the work's author."},{name:"introduction",group:"Front Matter",description:"A section in the beginning of the work, typically introducing the reader to the scope or nature of the work's content."},{name:"preamble",group:"Front Matter",description:"A section in the beginning of the work, typically containing introductory and/or explanatory prose regarding the scope or nature of the work's content"},{name:"epigraph",group:"Front Matter",description:"A quotation that is pertinent but not integral to the text."},{name:"non-specific frontmatter",group:"Front Matter",description:"Content placed in the frontmatter section, but which has no specific semantic meaning."},{name:"part",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"chapter",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"prologue",group:"Body Matter",description:"An introductory section that sets the background to a story, typically part of the narrative."},{name:"conclusion",group:"Body Matter",description:"An ending section that typically wraps up the work."},{name:"epilogue",group:"Body Matter",description:"A concluding section that is typically written from a later point in time than the main story, although still part of the narrative."},{name:"afterword",group:"Back Matter",description:"A closing statement from the author or a person of importance to the story, typically providing insight into how the story came to be written, its significance or related events that have transpired since its timeline."},{name:"non-specific backmatter",group:"Back Matter",description:"Content placed in the backmatter section, but which has no specific semantic meaning."},{name:"rearnote",group:"Back Matter",description:"A note appearing in the rear (backmatter) of the work, or at the end of a section."}],r={},i=0;i<n.length;i++){var o=n[i].group;(r[o]||(r[o]=[])).push(n[i])}e.exports={types:n,groups:r,getGroup:t}}()},{}],5:[function(t,e,n){!function(){"use strict";var r=t("d.js"),i=t("../../js/util/console")(),o=t("../../js/util/ajax"),c={mimetype:"application/epub+zip",container:'<?xml version="1.0" encoding="UTF-8"?>\n<container xmlns="urn:oasis:names:tc:opendocument:xmlns:container" version="1.0">\n\t<rootfiles>\n\t\t<rootfile full-path="EPUB/{{slug}}.opf" \t\n\t\t\tmedia-type="application/oebps-package+xml"/>\n\t</rootfiles>\n</container>',opf:'<?xml version="1.0" encoding="UTF-8"?>\n<package xmlns="http://www.idpf.org/2007/opf" version="3.0" unique-identifier="uid" xml:lang="en-US" prefix="cc: http://creativecommons.org/ns#">\n    <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n        <dc:identifier id="uid">{{uuid}}</dc:identifier>\n        <dc:title>{{title}}</dc:title>\n        <dc:creator>{{author}}</dc:creator>\n        <dc:language>{{lang}}</dc:language>\n        <dc:date>{{publicationDate}}</dc:date>\n        <meta property="dcterms:modified">{{modificationDate}}</meta>\n        {{#if rights}}\n            <!-- rights expressions for the work as a whole -->\n            {{#if rights.description}}<dc:rights>{{rights.description}}</dc:rights>{{/if}}\n            {{#if rights.license}}<link rel="cc:license" href="{{rights.license}}"/>{{/if}}\n            {{#if rights.attributionUrl}}<meta property="cc:attributionURL">{{attributionUrl}}</meta>{{/if}}\n        {{/if}}\n        {{#if coverUrl}}\n            {{#if coverRights}}\n                <!-- rights expression for the cover image -->       \n                {{#if coverRights.license}}<link rel="cc:license" refines="#cover" href="{{coverRights.license}}" />{{/if}}\n                {{#if coverRights.attributionUrl}}<link rel="cc:attributionURL" refines="#cover" href="{{coverRights.attributionUrl}}" />{{/if}}\n            {{/if}}\n                <!-- cover meta element included for 2.0 reading system compatibility: -->\n                <meta name="cover" content="cover"/>\n        {{/if}}\n    </metadata>\n    <manifest>\n        <item id="t1" href="{{slug}}-content.xhtml" media-type="application/xhtml+xml" />\n        <item id="nav" href="{{slug}}-nav.xhtml" properties="nav" media-type="application/xhtml+xml" />\n        {{#if coverUrl}}\n        <item id="cover" href="{{slug}}-cover.{{extension coverUrl}}" media-type="{{mimetype coverUrl}}" properties="cover-image" />\n        {{/if}}\n        <item id="css" href="{{slug}}.css" media-type="text/css" />\n        <!-- ncx included for 2.0 reading system compatibility: -->\n        <item id="ncx" href="{{slug}}.ncx" media-type="application/x-dtbncx+xml" />\n    </manifest>\n    <spine toc="ncx">\n        <itemref idref="t1" />        \n    </spine>    \n</package>\n',ncx:'<?xml version="1.0" encoding="UTF-8"?>\n<ncx xmlns:ncx="http://www.daisy.org/z3986/2005/ncx/" xmlns="http://www.daisy.org/z3986/2005/ncx/"\n    version="2005-1" xml:lang="en">\n    <head>\n        <meta name="dtb:uid" content="{{uuid}}"/>\n    </head>\n    <docTitle>\n        <text>{{title}}</text>\n    </docTitle>\n    <navMap>\n        <!-- 2.01 NCX: playOrder is optional -->\n\t\t{{#each toc}}\n        <navPoint id="{{id}}">\n            <navLabel>\n                <text>{{content.title}}</text>\n            </navLabel>\n            <content src="{{../slug}}-content.xhtml#{{id}}"/>\n        </navPoint>\n\t\t{{/each}}\n    </navMap>\n</ncx>\n',nav:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n\txmlns:epub="http://www.idpf.org/2007/ops">\n\t<head>\n\t\t<meta charset="utf-8"></meta>\t\t\n\t\t<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n\t</head>\n\t<body>\n\t\t<nav epub:type="toc" id="toc">\n\t\t\t<ol>\n\t\t\t\t{{#each toc}}\n\t\t\t\t<li><a href="{{../slug}}-content.xhtml#{{id}}">{{content.title}}</a></li>\n\t\t\t\t{{/each}}\n\t\t\t</ol>\t\t\t\n\t\t</nav>\n\t\t<nav epub:type="landmarks">\n\t\t\t<ol>\n\t\t\t\t{{#each landmarks}}\n\t\t\t\t<li><a epub:type="{{epubType}}" href="{{../slug}}-content.xhtml#{{id}}">{{#if content.title}}{{content.title}}{{else}}{{epubType}}{{/if}}</a></li>\n\t\t\t\t{{/each}}\n\t\t\t</ol>\n\t\t</nav>\n\t</body>\n</html>\n',css:'@charset "UTF-8";\n@namespace "http://www.w3.org/1999/xhtml";\n@namespace epub "http://www.idpf.org/2007/ops";\n\nbody {\n    margin-left: 6em;\n    margin-right: 2em;\n    color: black;\n    font-family: times, \'times new roman\', serif;\n    background-color: rgb(255,255,245);\n    line-height: 1.5em;\n}\n\nh2 {\n    margin-top: 5em;\n    margin-bottom: 2em;\n}\n\nh3 {\n    margin-top: 3em;\n}\n\n.linegroup {\n    margin-top: 1.6em;\n}\n\nspan.lnum {\n    float: right;\n    color: gray;\n    font-size : 90%;\n}\n\na.noteref {\n    color: rgb(215,215,195);\n    text-decoration: none;\n    margin-left: 0.5em;\n    margin-right: 0.5em;\n}\n\nsection#rearnotes a {\n    color: black;\n    text-decoration: none;\n    border-bottom : 1px dotted gray;\n    margin-right: 0.8em;\n}\n\n.indent {\n    padding-left: 3em;\n}\n\n.indent2 {\n    padding-left: 5em;\n}\n\n*[epub|type~=\'dedication\'] {\n    padding-left: 2em;\n}\n',content:'<?xml version="1.0" encoding="UTF-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" xmlns:epub="http://www.idpf.org/2007/ops">\n\t<head>\n\t\t<meta charset="utf-8"></meta>\n\t\t<title>{{title}}</title>\n\t\t<link rel="stylesheet" type="text/css" href="{{slug}}.css" class="day" title="day"/> \n\t</head>\n\t<body>\n\t\t{{#each sections}}{{> sectionTemplate}}{{/each}}\n\t</body>\n</html>\n',sectionsTemplate:'{{!-- strange if-construction, but this is a workaround for gulp-js-html-inject, whose minifier wreaks havoc otherwise --}}\n{{#if epubType}}<section epub:type="{{epubType}}" id="{{id}}">{{else}}<section id="{{id}}">{{/if}}\n\n    {{#if content.renderTitle}}<h2>{{content.title}}</h2>{{/if}} \n    {{#if content.content}}{{{content.content}}}{{/if}}\n    \n    {{#each subSections}} {{> sectionTemplate}} {{/each}}\n    \n{{#if epubType}}</section>{{else}}</section>{{/if}}'},s=function(){function t(t){t.file("mimetype",c.mimetype)}function e(t,e){t.folder("META-INF").file("container.xml",p(c.container,e))}function n(t,e){t.folder("EPUB").file(e.slug+".opf",p(c.opf,e))}function s(t,e){var n=r();return e.coverUrl?JSZipUtils.getBinaryContent(e.coverUrl,function(r,i){if(r)n.reject(r);else{var o=e.coverUrl.substr(e.coverUrl.lastIndexOf(".")+1);t.folder("EPUB").file(e.slug+"-cover."+o,i,{binary:!0}),n.resolve("")}}):n.resolve(!0),n.promise}function a(t,e){t.folder("EPUB").file(e.slug+".ncx",p(c.ncx,e))}function u(t,e){t.folder("EPUB").file(e.slug+"-nav.xhtml",p(c.nav,e))}function l(t,e){function n(){var n={original:e.stylesheet.replaceOriginal?"":c.css,custom:e.styles};t.folder("EPUB").file(e.slug+".css",p("{{{original}}}{{{custom}}}",n,!0)),i.resolve(!0)}var i=r();return e.stylesheet.url?o(e.stylesheet.url).then(function(t){e.styles=t.data,n()}):(n(),i.promise)}function f(t,e){Handlebars.registerPartial("sectionTemplate",c.sectionsTemplate),t.folder("EPUB").file(e.slug+"-content.xhtml",p(c.content,e))}function p(t,e,n){function r(t){return n||"undefined"==typeof html_beautify?t:html_beautify(t,{end_with_newline:!1,indent_char:"\t",indent_inner_html:!0,indent_size:"1",preserve_newlines:!1,wrap_line_length:"0",unformatted:[],selector_separator_newline:!1,newline_between_rules:!0})}return r(Handlebars.compile(t)(e))}this.make=function(o){i.debug("building epub",o);var c=new JSZip,p=r();return r.all(t(c),e(c,o),n(c,o),s(c,o),a(c,o),u(c,o),l(c,o),f(c,o)).then(function(){p.resolve(c)}),p.promise}};if("undefined"!=typeof e)e.exports.builder=new s;else if("undefined"!=typeof n)n.builder=new s;else if("undefined"==typeof window)throw new Error("unable to expose module: no module, exports object and no global window detected");"undefined"!=typeof window&&(window.epubMaker=new s)}()},{"../../js/util/ajax":6,"../../js/util/console":7,"d.js":2}],6:[function(t,e,n){!function(){"use strict";var n=t("d.js"),r=t("../../js/util/console")();e.exports=function(t,e){var i=n();try{var o=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");o.open(e?"POST":"GET",t,1),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){o.readyState>3&&i.resolve({data:o.responseText,xhr:o})},o.send(e)}catch(c){r.error(c),i.reject(c)}return i.promise}}()},{"../../js/util/console":7,"d.js":2}],7:[function(t,e,n){!function(){"use strict";function t(){}e.exports=function(){return"undefined"!=typeof console?console:{log:t,info:t,debug:t,warn:t,error:t}}}()},{}],8:[function(t,e,n){!function(){"use strict";function t(t){return t.substr(t.lastIndexOf(".")+1)}var e={jpeg:"image/jpeg",jpg:"image/jpeg",bmp:"image/bmp",png:"image/png",svg:"image/svg+xml",gif:"image/gif"};Handlebars.registerHelper("extension",function(e){return t(e)}),Handlebars.registerHelper("mimetype",function(n){return e[t(n)]})}()},{}],9:[function(t,e,n){!function(){"use strict";function t(t){return t.toLowerCase().replace(/\s\W/g,"-")}if(e.exports="undefined"!=typeof s&&s.slugify?s.slugify:t,e.exports===t){var n="undefined"!=typeof console&&console.debug?console.debug:function(){};n.call(console,"underscore.string not found, falling back on (very) simple slugify..")}}()},{}]},{},[1]);